---
layout: post
title: "iOS 9 대응"
tags: ['iOS']
date: 2015-09-23 21:43:00
---
# iOS 9 대응

으레 그렇듯이 이번 iOS 업데이트에 따라 iOS 9 대응을 했다. 어떤 앱이냐에 따라 대응할 부분이 달라지겠지만 fluttr에서는 크게 두 가지 정도만 대응해주면 됐다. 딥링크라고 표현하는것 같던데, 커스텀 url 스킴 사용이 iOS 9로 넘어오면서 제약이 생겨서 많이들 골머리를 앓고 있는 것 같지만 fluttr에는 해당하지 않는 부분이라 별다른 문제는 없었다. 별 건 아니지만 이번 작업을 마지막으로 한동안 iOS 개발은 안 하게 될 것 같아서 짤막하게나마 남겨본다. 

## App Transport Security

iOS 9로 들어오면서 https를 디폴트로 권장하게 되었다. [Configuring App Transport Security Exceptions in iOS 9 and OSX 10.11](http://ste.vn/2015/06/10/configuring-app-transport-security-ios-9-osx-10-11/) 를 참조하자. https를 사용하지 않으면 에러가 난다. 단, 위 링크의 하단에 나오는 것처럼 https를 사용하지 않도록 설정할 수도 있다. 제일 마지막에 나오는대로 `NSAllowsArbitraryLoads`를 `YES`로 설정하는 것이 가장 간단한 (하지만 보안은 취약한) 방법이다.

![ATS off](http://i.stack.imgur.com/QSnGS.png)  
[stackoverflow; Transport Security has Blocked a cleartext HTTP](http://stackoverflow.com/questions/31254725/transport-security-has-blocked-a-cleartext-http) 에서 가져왔다.

## Bitcode

Bitcode는 [LLVM IR](https://en.wikipedia.org/wiki/LLVM#LLVM_Intermediate_Representation)이다. IR이란 최적화(optimazation)를 위한 중간 단계 코드로, 뭔지 잘 모르겠으면 [LLVM on AOSABOOK](http://khanrc.tistory.com/entry/LLVM-on-AOSABOOK) 의 링크를 참조하자. 그런데 Xcode는 원래 LLVM기반이고, 당연히 bitcode를 써 왔는데 왜 갑자기 iOS 9에서 이슈가 될까?

[stackoverflow의 한 답변](http://stackoverflow.com/questions/31088618/impact-of-xcode-build-options-enable-bitcode-yes-no)에 따르면, 원래(iOS 8까지)는 이 bitcode의 최적화 후 해당 앱이 실행될 수 있는 모든 머신 환경, 즉 x86 32 and 64 bit modes (for the simulator) 와 arm6/arm7/arm7s/arm64 (for the device)에 대해 바이너리를 생성하여 하나의 파일로 합쳤다. 이를 [fat binary](https://en.wikipedia.org/wiki/Fat_binary#Apple.27s_Universal_binary)라고 한다. 이름에서부터 느껴지지만 당연히 사이즈가 커질 수 밖에 없다. 

iOS 9에 대응하는 Xcode 7에서는, 이 문제의 해결을 위해 ENABLE_BITCODE 옵션을 제공한다. 이 옵션은 앱스토어에 fat binary를 만들지 않고 bitcode binary를 업로드하고, 앱스토어는 이 bitcode binary를 받아 각 머신 환경별 바이너리를 생성한다. 그러면 사용자에게 이전보다 훨씬 작은 크기의 앱을 제공할 수 있다. 또한, 이론적으로는, LLVM 최적화기가 업데이트 되면 해당 부분을 즉각 반영할 수 있는 장점 또한 가지고 있다.

자, 그럼 그냥 쓰면 되는 거 같은데 무슨 대응이 필요하냐? 문제는 써드파티 프레임워크에 있다. 짐작컨대, 프레임워크를 fat binary 형태로 제공하는 경우 앱을 bitcode binary로 변환할 수 없기 때문에 앱이 사용하는 모든 프레임워크가 bitcode binary를 제공해야 한다. 나의 경우에는 구글맵이 해당 문제를 일으켰으며 1.10.2에서 대응했다고 하는데 업데이트 해도 마찬가지의 문제가 나서 결국 그냥 ENABLE_BITCODE 를 꺼버렸다. 앱 타겟의 `Build Settings`에 `Enable Bitcode`옵션이 있다. 

![turn off bitcode](http://i.stack.imgur.com/wkNX0.gif)  
이 [친절한 움짤](http://stackoverflow.com/questions/30848208/new-warnings-in-ios9)을 참고하자.

## 기타

이 외에도 메인 윈도우에서 루트뷰컨트롤러를 필수적으로 요구하는 문제 등의 잡다한 문제가 있었으나 간단한 부분이기에 생략한다.


[Tistory 원문보기](http://khanrc.tistory.com/119)
